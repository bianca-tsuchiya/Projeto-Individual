<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="assets/icone_logo_realistic.png" type="image/x-icon">
    <script src="./js/funcoes.js"></script>
    <link rel="stylesheet" href="./css/cadastro.css">
    <title>Realistic</title>
</head>

<body>
    <main>
        <section class="banner-cadastro" style="background-image: url(./assets/banner-cadastro.png);">
            <p class="boas-vindas-cadastro">Seja bem-vindo(a) ao <span class="texto-realistic">Realistic</span></p>
            <p class="texto-chamativo-cadastro">Conheça a arte do desenho realista sob uma nova perspectiva!</p>
            <img src="./assets/icone_logo_cadastro.png" alt="">
        </section>
        <section class="cadastro">
            <div class="titulo-form-cadastro">
                <p>Crie sua conta agora</p>
            </div>
            <div class="alerta_erro">
                <div class="card_erro" id="cardErro">
                    <span id="mensagem_erro"></span>
                </div>
            </div>
            <div class="alerta_sucesso">
                <div class="card_sucesso" id="cardSucesso">
                    <span id="mensagem_sucesso"></span>
                </div>
            </div>
            <div class="form-cadastro">
                <div class="nome-sobrenome-cadastro">
                    <div class="nome-cadastro">
                        <label for="inputNome">Nome</label>
                        <!-- <img src="./assets/alerta-atencao-erros-inputs.png" alt=""> -->
                        <input type="text" id="inputNome">
                        <div class="input-alerta">
                            <span class="alerta-erro-validacao" id="spanNomeInvalido"></span>
                        </div>
                    </div>
                    <div class="sobrenome-cadastro">
                        <label for="inputSobrenome">Sobrenome</label>
                        <input type="text" id="inputSobrenome">
                        <div class="input-alerta">
                            <span class="alerta-erro-validacao" id="spanSobrenomeInvalido"></span>
                        </div>
                    </div>
                </div>
                <div class="usuario-dataNasc-cadastro">
                    <div class="usuario-cadastro">
                        <label for="inputUsuario">Nome de usuário</label>
                        <input type="text" id="inputUsuario">
                    </div>
                    <div class="data-nasc-cadastro">
                        <label for="inputDataNasc">Data de nascimento</label>
                        <input type="date" id="inputDataNasc">
                        <div class="input-alerta">
                            <span class="alerta-erro-validacao" id="spanDataNascInvalido"></span>
                        </div>
                    </div>
                </div>
                <div class="email-cadastro">
                    <label for="inputEmail">E-mail</label>
                    <input type="email" id="inputEmail">
                    <div class="input-alerta">
                        <span class="alerta-erro-validacao" id="spanEmailInvalido"></span>
                    </div>
                </div>
                <div class="senha-confirm-cadastro">
                    <div class="senha-cadastro">
                        <label for="inputSenha">Senha</label>
                        <input type="password" id="inputSenha">
                        <div class="input-alerta">
                            <span class="alerta-erro-validacao" id="spanSenhaInvalida"></span>
                        </div>
                    </div>
                    <div class="confirm-senha-cadastro">
                        <label for="inputConfirmSenha">Confirmação de senha</label>
                        <input type="password" id="inputConfirmSenha">
                        <div class="input-alerta">
                            <span class="alerta-erro-validacao" id="spanConfirmSenhaInvalido"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="texto-termos">
                <p>Ao continuar, você concorda com os Termos de Serviço do Realistic e confirma que leu a Política de
                    Privacidade.</p>
            </div>
            <div class="btn-criar-conta">
                <button onclick="cadastrar()">Criar conta</button>
            </div>
            <!-- <div id="div_aguardar" class="loading-div">
                <img src="./assets/circle-loading.gif" id="loading-gif">
            </div> -->
            <div class="apelo-conta-existente">
                <p>Já tem uma conta?<a href="./login.html">Conecte-se</a></p>
            </div>
        </section>
    </main>
</body>

</html>

<script>

    // function validarNomeSobrenome() {
    //     const nomeValido = /^[a-zA-Z]+ [a-zA-Z]+$/; // REGEX - Regular Expression

    //     const nome = inputNome.value;
    //     const sobrenome = inputSobrenome.value;

    //     // O método test() executa uma busca por uma correspondência entre uma expressão regular e uma string. Retorna true ou false. Use test() sempre que você quiser saber se um padrão está dentro de uma string.

    //     if (!nomeValido.test(nome) || !nomeValido.test(sobrenome)) {
    //         alert('Invalid name given.');
    //     } else {
    //         alert('Valid name given.');
    //     }
    // }

    function cadastrar() {

        const usuario = {
            nome: inputNome.value,
            sobrenome: inputSobrenome.value,
            username: inputUsuario.value,
            dataNasc: inputDataNasc.value,
            email: inputEmail.value,
            senha: inputSenha.value,
            confirmSenha: inputConfirmSenha.value
        };

        // if (nomeVar == "" || emailVar == "" || senhaVar == "" || confirmacaoSenhaVar == "") {
        //     cardErro.style.display = "block"
        //     mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";

        //     finalizarAguardar();
        //     return false;
        // }
        // else {
        //     setInterval(sumirMensagem, 5000)
        // }

        if (usuario.nome == "" || usuario.sobrenome == "" || usuario.username == "" || usuario.dataNasc == "" || usuario.email == "" || usuario.senha == "" || usuario.confirmSenha == "") {
            cardErro.style.display = "flex"
            mensagem_erro.innerHTML = "ERRO! Preencha todos os campos adequadamente.";
        }
        else {

            // VALIDAÇÃO DE NOME E SOBRENOME
            var nomeInvalido = false;
            var sobrenomeInvalido = false;
            const nomeValido = /^[A-Z]{1}[a-z]+((\s)?([A-Za-z])+)*$/

            /*
            REGEX - Regular Expression
            RegEx - notação que faz verificações em textos com 3 principais aplicações (buscas por padrões, validações em textos e substituições).
            ? - to optional character
            * - Repite zero or more
            /^[A-Z]{1}[a-z]+$/; 
            */

            if (!nomeValido.test(usuario.nome)) {
                // O método test() executa uma busca por uma correspondência entre uma expressão regular e uma string. Retorna true ou false. Use test() sempre que você quiser saber se um padrão está dentro de uma string.

                nomeInvalido = true;
                spanNomeInvalido.innerHTML = `
                <img src="./assets/alerta-atencao-erros-inputs.png" alt="ícone de alerta"> 
                Digite um nome válido.
                `;
            }
            else if (nomeInvalido == false) {
                spanNomeInvalido.innerHTML = "";
            }

            if (!nomeValido.test(usuario.sobrenome)) {
                sobrenomeInvalido = true;
                spanSobrenomeInvalido.innerHTML = `
                <img src="./assets/alerta-atencao-erros-inputs.png" alt="ícone de alerta"> 
                Digite um sobrenome válido.
                `;
            }
            else if (sobrenomeInvalido == false) {
                spanSobrenomeInvalido.innerHTML = "";
            }


            //------------------------------------------

            //VALIDAÇÃO DE DATA DE NASCIMENTO

            var dataNascInvalido = false;
            var now = new Date(); //generate a new Date object containing the current date and time.

            const anoInputDataNasc = Number((usuario.dataNasc).slice(0, 4)); //Consersão de String para Number 
            // The String slice() method extracts the part of a string between the start and end indexes, which are specified by the first and second arguments respectively. 

            var idade = now.getFullYear() - anoInputDataNasc;
            //O método getFullYear() retorna o ano da data especificada de acordo com a hora local.

            if (idade >= 0 && idade < 13) {
                dataNascInvalido = true;
                spanDataNascInvalido.innerHTML = `
                <img src="./assets/alerta-atencao-erros-inputs.png" alt="ícone de alerta"> 
                Você precisa ter pelo menos 13 anos idade.
                `
            }
            else if (idade < 0 || idade > 120) {
                dataNascInvalido = true;
                spanDataNascInvalido.innerHTML = `
                <img src="./assets/alerta-atencao-erros-inputs.png" alt="ícone de alerta"> 
                Digite uma data de nascimento válida.
                `
            }
            else if (dataNascInvalido == false) {
                spanDataNascInvalido.innerHTML = "";
            }

            //---------------------------------------------

            //VALIDAÇÃO DE EMAIL
            var emailInvalido = false;
            const emailValido = /^[A-Za-z0-9]{1}[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*/

            // /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
            //\. - combinar com .
            //?: - noncapture

            if (!emailValido.test(usuario.email)) {
                emailInvalido = true;
                spanEmailInvalido.innerHTML = `
                <img src="./assets/alerta-atencao-erros-inputs.png" alt="ícone de alerta"> 
                Digite um endereço de e-mail válido.
                `;
            }
            else if (emailInvalido == false) {
                spanEmailInvalido.innerHTML = "";
            }

            // if(usuario.email[0] != /^[A-Za-z0-9]/ || usuario.email.charAt(usuario.email.length-1) != /^[A-Za-z0-9]/)
            // {
            //     console.log("O primeiro caractere do nome do usuário deve ser uma letra do tipo ascii (a-z) ou um número (0-9)")
            // }

            // if(usuario.email[0] == "@" || usuario.email[0] == "." || usuario.email[0] == "!" || usuario.email == []){
            // }

            // var listaCaracteresEspeciais = ["@", "!", "#", "$", "%", "*", "(", ")", "_", "-", "+", "/", "|", "\\", "`", "{", "}", "[", "]", ".", "^", "~", "'", "=", ":", ",", ";", ">", "" ]

            //---------------------------------------------

            //VALIDAÇÃO DE SENHA E CONFIRMAÇÃO DE SENHA
            var senhaInvalida = false;
            var confirmSenhaInvalido = false;

            if (usuario.senha.length < 8 || usuario.senha.search(/[a-z]/) == -1 || usuario.senha.search(/[A-Z]/) == -1 || usuario.senha.search(/[0-9]/) == -1 || usuario.senha.search(/[@.!#$%&'*+/=?^_`{|}~-]/) == -1) {

                senhaInvalida = true;
                spanSenhaInvalida.innerHTML = `
                <img src="./assets/alerta-atencao-erros-inputs.png" alt="ícone de alerta"> 
                Senha inválida! Digite uma senha de pelo menos 8 caracteres. Sua senha deve conter letra maiúscula, letra minúscula, números e caracteres especiais.
                `;
            }
            else if (usuario.confirmSenha != usuario.senha) {
                confirmSenhaInvalido = true;
                spanConfirmSenhaInvalido.innerHTML = `
                <img src="./assets/alerta-atencao-erros-inputs.png" alt="ícone de alerta"> 
                Senha incorreta! Digite a mesma senha digitada anteriormente.
                `;
            }
            else if (senhaInvalida == false) {
                spanSenhaInvalida.innerHTML = "";
            }
            else if (confirmSenhaInvalido == false) {
                spanConfirmSenhaInvalido.innerHTML = "";
            }
        }

        
        //cadastrar

        if (nomeInvalido == false && sobrenomeInvalido == false && dataNascInvalido == false && emailInvalido == false && senhaInvalida == false && confirmSenhaInvalido == false) {

            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nomeServer: usuario.nome,
                    sobrenomeServer: usuario.sobrenome,
                    usernameServer: usuario.username,
                    dataNascServer: usuario.dataNasc,
                    emailServer: usuario.email,
                    senhaServer: usuario.senha
                })
            }).then(function (resposta) {

                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    cardSucesso.style.display = "flex";
                    mensagem_sucesso.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                    setTimeout(() => {
                        window.location = "login.html";
                    }, "2000")

                } else {
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

            return false;

        }


        //     fetch("/usuarios/cadastrar", {
        //         method: "POST",
        //         headers: {
        //             "Content-Type": "application/json"
        //         },
        //         body: JSON.stringify({
        //             // crie um atributo que recebe o valor recuperado aqui
        //             // Agora vá para o arquivo routes/usuario.js
        //             nomeServer: usuario.nome,
        //             sobrenomeServer: usuario.sobrenome,
        //             usernameServer: usuario.username,
        //             dataNascSever: usuario.dataNasc,
        //             emailServer: usuario.email,
        //             senhaServer: usuario.senha
        //         })
        //     }).then(function (resposta) {

        //         console.log("resposta: ", resposta);

        //         if (resposta.ok) {
        //             // cardErro.style.display = "block";

        //             // mensagem_erro.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

        //             console.log("Cadastro realizado com sucesso! Redirecionando para tela de Login...");

        //             setTimeout(() => {
        //                 window.location = "login.html";
        //             }, "2000")

        //             limparFormulario();
        //             finalizarAguardar();
        //         } else {
        //             throw ("Houve um erro ao tentar realizar o cadastro!");
        //         }
        //     }).catch(function (resposta) {
        //         console.log(`#ERRO: ${resposta}`);
        //         finalizarAguardar();
        //     });

        //     return false;
        // }


        // function sumirMensagem() {
        //     cardErro.style.display = "none"
        // }
    }

</script>